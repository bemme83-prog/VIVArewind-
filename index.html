<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>VIVA REWIND - AD-SHIELD EDITION</title>
    <style>
        :root { --viva-pink: #ff00ff; --viva-cyan: #00ffff; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Arial Black', sans-serif; }
        
        /* Dual Player Layout */
        .player-container { position: absolute; inset: 0; transition: opacity 0.6s ease-in-out; background: #000; pointer-events: none; }
        #container-music { z-index: 10; opacity: 1; }
        #container-inter { z-index: 5; opacity: 0; }
        .active { opacity: 1 !important; z-index: 20 !important; }

        /* VIVA UI Elements */
        #viva-logo { position: absolute; top: 30px; right: 30px; z-index: 100; display: flex; }
        .logo-svg { width: 35px; height: 35px; fill: none; stroke-width: 12; stroke-linejoin: round; }
        .blau { stroke: #1a4a9e; } .gelb { stroke: #ffff00; }
        
        #tag { 
            position: absolute; bottom: 18%; left: 0; z-index: 200; 
            background: linear-gradient(90deg, var(--viva-cyan), var(--viva-pink)); 
            color: white; padding: 12px 35px; box-shadow: 8px 8px 0px #000; 
            transform: translateX(-105%); transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1); 
        }
        #tag.show { transform: translateX(0); }

        #status-box { position: absolute; top: 20px; right: 20px; z-index: 2000; background: rgba(0,0,0,0.8); color: #0f0; padding: 8px; font-family: monospace; font-size: 10px; border: 1px solid #0f0; }
        #overlay { position: fixed; inset: 0; z-index: 9999; background: #000; display: flex; justify-content: center; align-items: center; cursor: pointer; color: #fff; }
    </style>
</head>
<body>

<div id="status-box">AD-SHIELD: ACTIVE</div>
<div id="overlay" onclick="powerOn()"><h1 style="color:#ffff00">START VIVA</h1></div>

<div id="viva-logo">
    <svg class="logo-svg blau" viewBox="0 0 100 100"><path d="M15,25 L85,25 L50,85 Z"/></svg> 
    <svg class="logo-svg gelb" style="margin-left:-10px;" viewBox="0 0 100 100"><path d="M15,75 L85,75 L50,15 Z"/></svg> 
</div>

<div id="tag"><div id="video-title" style="font-size: 18px;">VIVA...</div></div>

<div id="container-music" class="player-container"><div id="player-music"></div></div>
<div id="container-inter" class="player-container"><div id="player-inter"></div></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let playerMusic, playerInter;
    let watchdog;
    let mode = 'MUSIC';
    let isSwitching = false;
    
    const musicPlaylistId = 'PLfYJatUfKgnlRa5IM0KI_ll0UyhYItnU2';
    const intermissions = ['h07xiwYGLvs', 'VId6Vv9S9M0', '8-nO87p97v8'];

    function onYouTubeIframeAPIReady() {
        const adShieldVars = {
            autoplay: 0, 
            controls: 0, 
            modestbranding: 1, 
            rel: 0, 
            iv_load_policy: 3, 
            enablejsapi: 1, 
            disablekb: 1,
            origin: window.location.origin,
            widget_referrer: window.location.href
        };

        playerMusic = new YT.Player('player-music', {
            height: '100%', width: '100%',
            host: 'https://www.youtube-nocookie.com',
            playerVars: adShieldVars,
            events: { 'onStateChange': (e) => handleState(e, 'MUSIC'), 'onReady': (e) => e.target.unMute() }
        });

        playerInter = new YT.Player('player-inter', {
            height: '100%', width: '100%',
            host: 'https://www.youtube-nocookie.com',
            playerVars: adShieldVars,
            events: { 'onStateChange': (e) => handleState(e, 'INTER'), 'onReady': (e) => e.target.unMute() }
        });
    }

    function handleState(event, playerType) {
        if (playerType === 'MUSIC' && event.data === YT.PlayerState.ENDED && mode === 'MUSIC') doZapToInter();
        if (playerType === 'INTER' && event.data === YT.PlayerState.ENDED && mode === 'INTER') doZapToMusic();

        if (playerType === 'MUSIC' && event.data === YT.PlayerState.PLAYING) {
            startWatchdog();
            if (mode === 'MUSIC') showInfoTag();
        }

        // Silent Preload Warm-up für Einspieler
        if (playerType === 'INTER' && event.data === YT.PlayerState.PLAYING && mode === 'MUSIC') {
            playerInter.pauseVideo();
            document.getElementById('status-box').innerText = "AD-SHIELD: READY";
        }
    }

    function showInfoTag() {
        try {
            const title = playerMusic.getVideoData().title;
            if (title) {
                document.getElementById('video-title').innerText = title;
                document.getElementById('tag').classList.add('show');
                setTimeout(() => document.getElementById('tag').classList.remove('show'), 6000);
            }
        } catch(e) {}
    }

    function startWatchdog() {
        clearInterval(watchdog);
        watchdog = setInterval(() => {
            if (mode === 'MUSIC' && playerMusic.getDuration) {
                const timeLeft = playerMusic.getDuration() - playerMusic.getCurrentTime();
                
                // Preload bei 35s
                if (timeLeft <= 35 && timeLeft > 30) {
                    const state = playerInter.getPlayerState();
                    if (state !== 1 && state !== 3) {
                        playerInter.mute();
                        playerInter.loadVideoById(intermissions[Math.floor(Math.random() * intermissions.length)]);
                    }
                }

                if (timeLeft <= 1.2 && timeLeft > 0 && !isSwitching) doZapToInter();
                document.getElementById('status-box').innerText = "REST: " + Math.round(timeLeft) + "s";
            }
        }, 500);
    }

    function doZapToInter() {
        if (isSwitching) return;
        isSwitching = true;
        mode = 'INTER';
        clearInterval(watchdog);
        
        document.getElementById('container-music').style.opacity = "0";
        document.getElementById('container-inter').classList.add('active');
        
        playerInter.unMute();
        playerInter.playVideo();
        
        // Preload nächstes Musikvideo im Hintergrund
        setTimeout(() => {
            playerMusic.mute();
            playerMusic.loadPlaylist({ list: musicPlaylistId, listType: 'playlist', index: Math.floor(Math.random() * 50) });
            isSwitching = false;
        }, 2000);
    }

    function doZapToMusic() {
        if (isSwitching) return;
        isSwitching = true;
        mode = 'MUSIC';
        document.getElementById('container-inter').classList.remove('active');
        document.getElementById('container-music').style.opacity = "1";
        playerMusic.unMute();
        playerMusic.playVideo();
        setTimeout(() => { isSwitching = false; }, 2000);
    }

    function powerOn() {
        document.getElementById('overlay').style.display = 'none';
        playerMusic.loadPlaylist({ list: musicPlaylistId, listType: 'playlist', index: Math.floor(Math.random() * 50) });
    }
</script>
</body>
</html>
